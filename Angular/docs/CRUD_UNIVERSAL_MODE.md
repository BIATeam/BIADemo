# CRUD
This document explains how to quickly create a CRUD module feature universal.
It means that you can switch this functionnalities:
- Navigation in Page mode / Popup Mode
- Use view / Not use view
- Modification in the table / in dedicated form 
- Refresh with SignalR / not use signalR
  
<u>For this example, we imagine that we want to create a new feature with the name: <span style="background-color:yellow">aircrafts-types</span>.   </u>

## Prerequisite
The back-end is ready, i.e. the <span style="background-color:yellow">AircraftType</span> controller exists as well as permissions such as `AircraftType_List_Access`.

## Create a new feature
First, create a new <span style="background-color:yellow">aircrafts-types</span> folder under the **src\app\features** folder of your project.   
Then copy, paste and unzip into this feature <span style="background-color:yellow">aircrafts-types</span> folder the contents of :
  * **Angular\docs\feature-planes.zip** Universal Mode 

Then, inside the folder of your new feature, execute the file **new-crud.ps1**   
For **new crud name? (singular)**, type <span style="background-color:yellow">aircraft-type</span> 
For **new crud name? (plural)**, type <span style="background-color:yellow">aircrafts-types</span>
When finished, you can delete **new-crud.ps1**   

## Update permission
Open the file **src\app\shared\permission.ts** and in the **Permission** enum, add
```typescript
  AircraftType_Create = 'AircraftType_Create',
  AircraftType_Delete = 'AircraftType_Delete',
  AircraftType_List_Access = 'AircraftType_List_Access',
  AircraftType_Read = 'AircraftType_Read',
  AircraftType_Save = 'AircraftType_Save',
  AircraftType_Update = 'AircraftType_Update',
```

## Update navigation
Open the file **src\app\shared\navigation.ts** and in the array **NAVIGATION**, add 
```typescript
{
  labelKey: 'app.aircraftsTypes',
  permissions: [Permission.AircraftType_List_Access],
  path: ['/aircrafts-types']
}
```

## Update routing
Open the file **src\app\app-routing.module.ts** and in the array **routes**, add 
```typescript
{
  path: 'aircrafts-types',
  data: {
    breadcrumb: 'app.aircraftsTypes',
    canNavigate: true
    },
    loadChildren: () => import('./features/aircrafts/aircraft-type.module').then((m) => m.AircraftTypeModule)
}
```

## Create the model
Use the back-end with swagger to retrieve a json from the new entity <span style="background-color:yellow">AircraftType</span>.   
Use this site to convert the json to interface TypeScript:   
http://json2ts.com/   
And then, copy the generated code in **src\app\features\aircrafts\model\aircraft-type.ts**

If you have a related model you have 2 models to generate replace all any and object generated by OptionDto.

## Update translations
Open the file **src\assets\i18n\app\en.json** and   
add in `"app"`
```json
"app": {
    ...
    "aircraftsType": "Aircrafts types"
  }
```
add 
```json
"aircraftType": {
  "add": "Add aircraft type",
  "edit": "Edit aircraft type",
  "listOf": "List of aircrafts types"
  }
```
and add translations of interface properties.

Open the file **src\assets\i18n\app\fr.json** and
add in `"app"`
```json
"app": {
    ...
    "aircraftsType": "Type d'aéronefs"
  }
```
add
```json
"aircraftType": {
    "add": "Ajouter type d'aéronef",
    "edit": "Modifier type d'aéronef",
    "listOf": "Liste des types d'aéronefs"
  }
```
and add translations of interface properties.

Open the file **src\assets\i18n\app\es.json** and
add in `"app"`
```json
"app": {
    ...
    "aircraftsType": "Aeronaves"
  }
```
add
```json
"aircraftType": {
   "add": "Añadir tipo de aeronave",
    "edit": "Editar tipo de aeronave",
    "listOf": "Lista de tipos de aeronaves"
  }
```
and add translations of interface properties.

When you have finished adding translations, use this site to sort your json:
https://novicelab.org/jsonabc/

## Form
Change the following form component to match the model and the business requirements:
**src\app\features\aircrafts-types\components\aircraft-type-form**

## Table
Open the following file **src\app\features\aircrafts\views\aircrafts-types-index\aircrafts-types-index.component.ts**   
Change columns field of the `tableConfiguration` variable according to the columns in the table you want to display.   
If it is a simple string type column with filter and possible sorting, then use this column line to define your column.
```typescript
new PrimeTableColumn('msn', 'aircraft.msn'),
```
If the column type is not a string, or if the column is not sortable, or not sortable, you must define the column as follows: 
```typescript
Object.assign(new PrimeTableColumn('msn', 'aircraft.msn'), {
        isSearchable: false,
        isSortable: false,
        type: TypeTS.Number
      })
```

## Relation to Option
### Universal Mode
* In universal mode the loading of the relations are done in **...OptionsService**
* Adapt the lists to display in combo box in :
  * the members of the classe, 
  * the constructor 
  * the function loadAllOptions.
* The list should be OptionDto list in domain. See [this page](OPTION.md) to create the domain feature option.

## Enable Views
* Just change the variable useView = false; to useView = true; in the **...-index.component.ts**

## Enable SignalR:
* Just change the variable useSignalR = false; to useSignalR = true; in the **...-index.component.ts**

## Spreadsheet mode
* Just change the variable useCalc = false; to useCalc = true; in the **...-index.component.ts**

### Specific Input
For specific properties that are not managed by the Framework, your table component must have an html. In this html, you have to copy/paste the content of the html from **bia-calc-table.component.html**.

In this html, you must add your components in the **SPECIFIC INPUT** zone and **SPECIFIC OUTPUT** zone.

```html
<!-- Begin Add here specific input -->
<!-- End Add here specific input -->
...
<!-- Begin Add here specific output -->
<!-- End Add here specific output -->
```

in your typescript file, you must fill the **specificInputs** property.

``` typescript
specificInputs: string[] = [
    'potting',
    'locking',
    ...
  ];
```
