@if (configuration) {
  <p-table
    #dt
    [reorderableColumns]="reorderableColumns"
    [resizableColumns]="isResizableColumn"
    [columnResizeMode]="'expand'"
    [columns]="displayedColumns"
    [value]="elements"
    [paginator]="!virtualScroll && paginator"
    [rows]="virtualScroll ? virtualScrollPageSize : pageSize"
    (onFilter)="onFilter()"
    [totalRecords]="totalRecord"
    [lazy]="true"
    [loading]="loading && (showLoading$ | async) !== null"
    (onLazyLoad)="onLoadLazy($event)"
    [stateStorage]="'session'"
    [stateKey]="tableStateKey"
    [lazyLoadOnInit]="getLazyLoadOnInit()"
    [sortField]="sortFieldValue"
    [sortOrder]="sortOrderValue"
    (onStateSave)="onStateSave($event)"
    (selectionChange)="onSelectionChange()"
    stripedRows
    [sortMode]="sortMode"
    [multiSortMeta]="multiSortMeta"
    [scrollHeight]="scrollHeightValue"
    [scrollable]="isScrollable"
    [(selection)]="selectedElements"
    [virtualScroll]="virtualScroll"
    [virtualScrollItemSize]="rowHeight"
    [virtualScrollOptions]="{ scrollHeight: scrollHeightValue }"
    dataKey="id"
    [expandedRowKeys]="expandedRows"
    (onRowExpand)="onRowExpand($event)"
    (onRowCollapse)="onRowCollapse($event)"
    (onPage)="pageChange.emit($event)">
    <ng-template pTemplate="header" let-columns>
      <tr>
        @if (canSelectElement === true && !readOnly) {
          <th
            class="bia-table-select-col"
            [style.width]="widthSelect"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            @if (canSelectMultipleElement) {
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            }
          </th>
        }
        @if (canExpandRow) {
          <th
            [style.width]="widthExpand"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen"></th>
        }
        @if (showFixableState) {
          <th
            [style.width]="widthSelect"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            {{ 'bia.fixed' | translate }}
          </th>
        }
        @for (col of columns; track $index) {
          @if (col?.isSortable === true) {
            <th
              [pSortableColumn]="col.field"
              pReorderableColumn
              [pReorderableColumnDisabled]="col.isFrozen"
              pResizableColumn
              [style.min-width]="col.minWidth"
              [style.max-width]="col.maxWidth"
              [alignFrozen]="col.alignFrozen"
              biaFrozenColumn
              [frozen]="col.isFrozen"
              pTooltip="{{
                isResizableColumn && !col?.icon ? getColumnHeader(col) : ''
              }}"
              tooltipPosition="top">
              <span class="nowrap">
                @if (!!col?.icon) {
                  <i
                    class="{{ col?.icon }} bia-column-icon"
                    pTooltip="{{ getColumnHeader(col) }}"
                    tooltipPosition="top"></i>
                } @else {
                  {{ getColumnHeader(col) }}
                }
                <p-sortIcon [field]="col.field"></p-sortIcon>
              </span>
            </th>
          }
          @if (col?.isSortable !== true) {
            <th
              pReorderableColumn
              [pReorderableColumnDisabled]="col.isFrozen"
              pResizableColumn
              [style.min-width]="col.minWidth"
              [style.max-width]="col.maxWidth"
              [alignFrozen]="col.alignFrozen"
              biaFrozenColumn
              [frozen]="col.isFrozen"
              pTooltip="{{
                isResizableColumn && !col?.icon ? getColumnHeader(col) : ''
              }}"
              tooltipPosition="top">
              <span class="nowrap">
                @if (!!col?.icon) {
                  <i
                    class="{{ col?.icon }} bia-column-icon"
                    pTooltip="{{ getColumnHeader(col) }}"
                    tooltipPosition="top"></i>
                } @else {
                  {{ getColumnHeader(col) }}
                }
              </span>
            </th>
          }
        }
      </tr>
      @if (showColSearch === true) {
        <tr class="searchTR">
          @if (canSelectElement === true && !readOnly) {
            <th
              [style.width]="widthSelect"
              [alignFrozen]="alignFrozenSelect"
              biaFrozenColumn
              pResizableColumn
              [frozen]="isSelectFrozen"></th>
          }
          @if (canExpandRow) {
            <th
              [style.width]="widthExpand"
              [alignFrozen]="alignFrozenSelect"
              biaFrozenColumn
              pResizableColumn
              [frozen]="isSelectFrozen"></th>
          }
          @if (showFixableState) {
            <th
              [style.width]="widthSelect"
              [alignFrozen]="alignFrozenSelect"
              biaFrozenColumn
              pResizableColumn
              [frozen]="isSelectFrozen"></th>
          }
          @for (col of columns; track $index) {
            <th
              pReorderableColumn
              pResizableColumn
              [style.min-width]="col.minWidth"
              [style.max-width]="col.maxWidth"
              [alignFrozen]="col.alignFrozen"
              biaFrozenColumn
              [frozen]="col.isFrozen">
              <bia-table-filter
                [field]="col"
                [table]="dt"
                [options]="getOptionDto(col.field)">
              </bia-table-filter>
            </th>
          }
        </tr>
      }
    </ng-template>
    <ng-template
      pTemplate="body"
      let-rowData
      let-columns="columns"
      let-ri="rowIndex"
      let-expanded="expanded">
      <tr [pSelectableRow]="rowData" [ngClass]="{ 'p-even-row': ri % 2 === 0 }">
        @if (canSelectElement === true && !readOnly) {
          <td
            [style.width]="widthSelect"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            @if (rowData.id !== 0 && rowData.id !== '') {
              @if (canSelectMultipleElement === true) {
                <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
              } @else {
                <p-tableRadioButton [value]="rowData"></p-tableRadioButton>
              }
            }
          </td>
        }
        @if (canExpandRow) {
          <td
            [class]="'bia-column-expand'"
            [style.width]="widthExpand"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            <i
              [pRowToggler]="rowData"
              [class]="expanded ? 'pi pi-angle-down' : 'pi pi-angle-right'"></i>
          </td>
        }
        @if (showFixableState) {
          <td
            [style.width]="widthSelect"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            @if (rowData.isFixed === true) {
              <div class="flex justify-content-center">
                <i class="pi pi-lock"></i>
              </div>
            }
          </td>
        }
        @for (col of columns; track $index) {
          <td
            [class]="'bia-column-' + col.typeLowerCase"
            (click)="clickElementData(rowData)"
            [style.min-width]="col.minWidth"
            [style.max-width]="col.maxWidth"
            [alignFrozen]="col.alignFrozen"
            biaFrozenColumn
            [frozen]="col.isFrozen">
            <bia-table-output
              [field]="col"
              [data]="getCellData(rowData, col)"
              [ignoreSpecificOutput]="ignoreSpecificOutput">
              <ng-template pTemplate="specificOutput">
                <ng-container
                  *ngTemplateOutlet="
                    specificOutputTemplate;
                    context: {
                      rowData: rowData,
                      field: col,
                      data: getCellData(rowData, col),
                    }
                  "></ng-container>
              </ng-template>
            </bia-table-output>
          </td>
        }
      </tr>
    </ng-template>
    @if (canExpandRow) {
      <ng-template pTemplate="expandedrow" let-rowData>
        <tr>
          <td colspan="100%">
            <ng-container
              [ngTemplateOutlet]="expandedRowTemplate"
              [ngTemplateOutletContext]="{ data: rowData }"></ng-container>
          </td>
        </tr>
      </ng-template>
    }
    <ng-template
      pTemplate="loadingbody"
      let-columns="columns"
      let-ri="rowIndex">
      <tr
        [style]="'height: ' + rowHeight + 'px'"
        [ngClass]="{ 'p-even-row': ri % 2 !== 0 }">
        @if (canSelectElement === true && !readOnly) {
          <td
            [style.width]="widthSelect"
            [alignFrozen]="alignFrozenSelect"
            biaFrozenColumn
            [frozen]="isSelectFrozen">
            <p-skeleton
              [ngStyle]="{
                width: '60%',
              }" />
          </td>
        }
        @for (col of columns; track $index; let even = $even) {
          <td>
            <p-skeleton
              [ngStyle]="{
                width: even ? '40%' : '60%',
              }" />
          </td>
        }
      </tr>
    </ng-template>
    <ng-container>
      <ng-template pTemplate="summary" let-columns>
        @if (virtualScroll) {
          <bia-table-footer-controller
            [length]="totalRecord"
            [pageSize]="pageSize"
            [canChangePageSize]="false"
            (pageSizeChange)="
              onPageSizeValueChange($event)
            "></bia-table-footer-controller>
        }</ng-template
    ></ng-container>
    <ng-template pTemplate="paginatorleft">
      <bia-table-footer-controller
        [length]="totalRecord"
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        [canChangePageSize]="!!pageSizeOptions"
        (pageSizeChange)="
          onPageSizeValueChange($event)
        "></bia-table-footer-controller>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td
          class="app-empty-message"
          [attr.colspan]="columns?.length + (showFixableState ? 2 : 1)">
          {{ 'bia.NoRecordsFound' | translate }}
        </td>
      </tr>
    </ng-template>
  </p-table>
}
