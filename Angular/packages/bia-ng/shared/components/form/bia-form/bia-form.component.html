<ng-template #tooltipContent>
  <div>
    <p>
      {{ 'bia.formHelp.summary' | translate }}
    </p>
    <ul>
      <li>
        <b>{{ 'bia.formHelp.tab' | translate }}</b>
        {{ 'bia.formHelp.tabDescription' | translate }}
      </li>
      <li>
        <b>{{ 'bia.formHelp.shiftTab' | translate }}</b>
        {{ 'bia.formHelp.shiftTabDescription' | translate }}
      </li>
      <li>
        <b>{{ 'bia.formHelp.downArrow' | translate }}</b>
        {{ 'bia.formHelp.downArrowDescription' | translate }}
      </li>
      <li>
        <b>{{ 'bia.formHelp.enter' | translate }}</b>
        {{ 'bia.formHelp.enterDescription' | translate }}
      </li>
      <li>
        <b>{{ 'bia.formHelp.space' | translate }}</b>
        {{ 'bia.formHelp.spaceDescription' | translate }}
      </li>
      <li>
        <b>{{ 'bia.formHelp.escape' | translate }}</b>
        {{ 'bia.formHelp.escapeDescription' | translate }}
      </li>
    </ul>
  </div>
</ng-template>
@if (form && shown) {
  <form
    (submit)="onSubmit()"
    class="flex flex-column bia-form"
    [formGroup]="form">
    @if (showHeaderContainer) {
      <div id="header" class="header-container bia-form-header">
        <div class="fixed-state">
          @if (isFixableButtonVisible) {
            <button
              pButton
              icon="pi {{ fixableButtonIcon }}"
              label="{{ fixableButtonLabel | translate }}"
              type="button"
              [disabled]="!canFix"
              [ngClass]="{ 'p-button-outlined': !isFixed }"
              (click)="onFixableButtonClicked()"></button>
          }
          @if (showPopupButton) {
            <button
              pButton
              icon="pi pi-clone"
              severity="secondary"
              type="button"
              [text]="true"
              (click)="switchToPopup()"
              pTooltip="{{ 'bia.usePopup' | translate }}"
              tooltipPosition="top"></button>
          }
          @if (showSplitButton) {
            <button
              pButton
              icon="pi pi-stop"
              severity="secondary"
              type="button"
              [text]="true"
              (click)="switchToSplit()"
              pTooltip="{{ 'bia.useSplit' | translate }}"
              tooltipPosition="top">
              <div class="split-icon pi pi-minus"></div>
            </button>
          }
          @if (showFullPageButton) {
            <button
              pButton
              icon="pi pi-stop"
              severity="secondary"
              type="button"
              [text]="true"
              (click)="switchToFullPage()"
              pTooltip="{{ 'bia.useFullPage' | translate }}"
              tooltipPosition="top"></button>
          }
        </div>
      </div>
    }
    <ng-template #formFields>
      <div class="bia-form-fields" #refFormField>
        @if (formLayoutConfig) {
          <bia-form-layout
            [element]="element"
            [formLayoutConfig]="formLayoutConfig"
            [dictOptionDtos]="dictOptionDtos"
            [readOnly]="readOnly"
            [isAdd]="isAdd"
            [specificInputTemplate]="specificInputTemplate"
            [specificOutputTemplate]="specificOutputTemplate"></bia-form-layout>
        }
        @for (field of fieldsWithoutLayoutConfig; track field) {
          <bia-form-field
            [element]="element"
            [field]="field"
            [isAdd]="isAdd"
            [dictOptionDtos]="dictOptionDtos"
            [readOnly]="readOnly"
            [specificInputTemplate]="specificInputTemplate"
            [specificOutputTemplate]="specificOutputTemplate"></bia-form-field>
        }
      </div>
    </ng-template>
    @if (displayHistorical) {
      <p-tabs value="0">
        <p-tablist #formTablist>
          <p-tab value="0">{{ 'bia.details' | translate }}</p-tab>
          <p-tab value="1">{{ 'bia.historical' | translate }}</p-tab>
        </p-tablist>
        <p-tabpanels class="form-tabpanels">
          <p-tabpanel value="0">
            <ng-container *ngTemplateOutlet="formFields"></ng-container>
          </p-tabpanel>
          <p-tabpanel value="1">
            <bia-crud-item-historical-timeline
              [fields]="fields"
              [historicalEntries]="
                historicalEntries
              "></bia-crud-item-historical-timeline>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    } @else {
      <ng-container *ngTemplateOutlet="formFields"></ng-container>
    }
    <div class="footer-container bia-form-fixed-buttons">
      @if (showFormHelp) {
        <i
          class="pi pi-question-circle"
          [pTooltip]="tooltipContent"
          tooltipPosition="top"
          tooltipStyleClass="bia-tooltip-large"
          positionLeft="80"></i>
      }
      <div class="flex gap-2 align-items-center info-locked-container">
        @if (isCrudItemOutdated) {
          <button
            pButton
            class="info-locked-button"
            type="button"
            icon="pi pi-info"
            [rounded]="true"
            severity="warn"
            [outlined]="true"
            size="small"></button>
        }
        @if (isCrudItemOutdated) {
          <span class="info-locked-label">{{
            'bia.outdatedData' | translate
          }}</span>
        }
      </div>
      <div class="flex gap-3">
        <button
          pButton
          icon="pi pi-times"
          label="{{ cancelButtonLabel | translate }}"
          type="button"
          class="p-button-outlined"
          (click)="onCancel()"></button>
        @if (isSubmitButtonVisible) {
          <button
            pButton
            icon="pi {{ submitButtonIcon }}"
            label="{{ submitButtonLabel | translate }}"
            type="submit"
            [loading]="submittingForm"
            [disabled]="isSubmitButtonDisabled"></button>
        }
      </div>
    </div>
  </form>
}
