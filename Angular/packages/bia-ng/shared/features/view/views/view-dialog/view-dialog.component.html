<p-dialog
  #viewDialog
  header="{{ 'bia.views.manageViews' | translate }}"
  [focusOnShow]="false"
  [(visible)]="display"
  [modal]="true"
  [closable]="true"
  [maximizable]="true"
  [contentStyle]="{ overflow: 'auto' }"
  (onHide)="onClose()"
  (onShow)="showDialogMaximized(viewDialog)">
  @if (display) {
    <p-tabs value="0">
      @let teams = teams$ | async;
      <p-tablist>
        @if (canSetUserView) {
          <p-tab value="0">{{
            'bia.views.user' | translate | uppercase
          }}</p-tab>
        }
        @if (canSetTeamView && (teams ?? []).length > 0) {
          <p-tab value="1"
            >{{ 'bia.views.team' | translate | uppercase }}
            {{ teams?.length === 1 ? teamSelected.title : '' }}</p-tab
          >
        }
      </p-tablist>
      <p-tabpanels>
        @if (canSetUserView) {
          <p-tabpanel value="0">
            @if (canAddUserView === true || canUpdateUserView === true) {
              <div class="app-div-view-form">
                <div>
                  {{ 'bia.views.msg.explanationSaveView' | translate }} :
                </div>
                <bia-view-form
                  [view]="userViewSelected"
                  (save)="onSaveUserView($event)"></bia-view-form>
              </div>
            }
            <bia-view-user-table
              [views]="(viewUsers$ | async) ?? []"
              [canDelete]="canDeleteUserView"
              [canSetDefault]="canSetDefaultUserView"
              [canUpdate]="canUpdateUserView"
              (delete)="onDeleteUserView($event)"
              (setDefault)="onSetDefaultUserView($event)"
              (viewSelect)="onUserViewSelected($event)"></bia-view-user-table>
          </p-tabpanel>
        }
        @if (canSetTeamView && (teams ?? []).length > 0) {
          <p-tabpanel value="1">
            <div class="app-div-select-team">
              @if ((teams ?? []).length > 1) {
                <p-select
                  optionLabel="title"
                  placeholder="{{ 'bia.views.selectTeam' | translate }}"
                  [options]="teams ?? []"
                  [(ngModel)]="teamSelected"></p-select>
              }
            </div>
            @if (teamSelected) {
              @if (canAddTeamView === true || canUpdateTeamView === true) {
                <div class="app-div-view-form">
                  <div>
                    {{ 'bia.views.msg.explanationSaveView' | translate }} :
                  </div>
                  <bia-view-form
                    [view]="teamViewSelected"
                    (save)="onSaveTeamView($event)"></bia-view-form>
                </div>
              }
              <bia-view-team-table
                [views]="(viewTeams$ | async) ?? []"
                [teamSelected]="teamSelected"
                [canDelete]="canDeleteTeamView"
                [canSetDefault]="canSetDefaultTeamView"
                [canUpdate]="canUpdateTeamView"
                [canAssign]="canAssignTeamView"
                (assignViewToTeam)="onAssignViewToTeam($event)"
                (delete)="onDeleteTeamView($event)"
                (setDefault)="onSetDefaultTeamView($event)"
                (viewSelect)="onTeamViewSelected($event)"></bia-view-team-table>
            }
          </p-tabpanel>
        }
      </p-tabpanels>
    </p-tabs>
  }
  <p-footer>
    <div class="flex flex-row align-content-end justify-content-end gap-3">
      <button
        id="btn-close"
        type="button"
        pButton
        (click)="display = false"
        label="{{ 'bia.close' | translate }}"></button>
    </div>
  </p-footer>
</p-dialog>
<p-confirmDialog key="view-confirm" [baseZIndex]="10000"></p-confirmDialog>
