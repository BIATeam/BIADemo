<p-table
  *ngIf="configuration"
  #dt
  [autoLayout]="true"
  [reorderableColumns]="true"
  [columns]="displayedColumns"
  [value]="elements"
  [paginator]="paginator"
  [rows]="pageSize"
  (onFilter)="onFilter()"
  [totalRecords]="totalRecord"
  [lazy]="true"
  [loading]="loading && (showLoading$ | async) !== null"
  (onLazyLoad)="onLoadLazy($event)"
  [stateStorage]="'session'"
  [stateKey]="tableStateKey"
  [lazyLoadOnInit]="getLazyLoadOnInit()"
  [sortField]="sortFieldValue"
  [sortOrder]="sortOrderValue"
  (onStateSave)="onStateSave($event)"
  (selectionChange)="onSelectionChange()"
  styleClass="p-datatable-striped"
>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th class="bia-table-select-col" *ngIf="canSelectElement">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      <ng-container *ngFor="let col of columns">
        <th *ngIf="col?.isSortable === true" [pSortableColumn]="col.field" pReorderableColumn>
          {{ col?.header | translate }}
          <p-sortIcon [field]="col.field"></p-sortIcon>
        </th>
        <th *ngIf="col?.isSortable !== true" pReorderableColumn>
          {{ col?.header | translate }}
        </th>
      </ng-container>
    </tr>
    <tr *ngIf="showColSearch" class="searchTR">
      <th *ngIf="canSelectElement"></th>
      <th *ngFor="let col of columns" [ngSwitch]="col.field" pReorderableColumn>
        <span *ngIf="col.isSearchable === true" class="p-float-label">
          <div fxLayout="row" fxLayoutAlign="center">
            <div class="app-field-container" fxFlex="10">
              <ng-container *ngIf="!isArraySimple(col)">
                <p-columnFilter [type]="col.type==='Date'?'date':'text'" 
                                [field]="col.field" display="menu"></p-columnFilter>
              </ng-container>
            </div>
            <div class="app-field-container" fxFlex="90" >
              <span *ngIf="isArrayFilter(col)"style="padding-left:20px; vertical-align: text-top;" >
                <ng-container *ngFor="let filter of dt.filters[col.field]" >
                  <ng-container *ngIf="filter.value != null">
                    <ng-container [ngSwitch]="filter.matchMode">
                      <ng-container *ngSwitchCase="'startsWith'">
                        [{{ filter.value }}*]
                      </ng-container>
                      <ng-container *ngSwitchCase="'contains'">
                        [*{{ filter.value }}*]
                      </ng-container>
                      <ng-container *ngSwitchCase="'notContains'">
                        ![*{{ filter.value }}*]
                      </ng-container>
                      <ng-container *ngSwitchCase="'endsWith'">
                        [*{{ filter.value }}]
                      </ng-container>
                      <ng-container *ngSwitchCase="'dateIs'">
                        [<bia-table-output [field]="col" [data]="filter.value"></bia-table-output>]
                      </ng-container>
                      <ng-container *ngSwitchCase="'dateIsNot'">
                        ![<bia-table-output [field]="col" [data]="filter.value"></bia-table-output>]
                      </ng-container>
                      <ng-container *ngSwitchCase="'dateBefore'">
                        <[<bia-table-output [field]="col" [data]="filter.value"></bia-table-output>]
                      </ng-container>
                      <ng-container *ngSwitchCase="'dateAfter'">
                        >[<bia-table-output [field]="col" [data]="filter.value"></bia-table-output>]
                      </ng-container>
                      <ng-container *ngSwitchDefault>{{ filter.matchMode + " " + filter.value }}</ng-container>
                    </ng-container>
                    
                  </ng-container>
                </ng-container>
              </span>
              <ng-container *ngIf="!isArrayFilter(col)">
                <input
                  pInputText
                  class="input-search"
                  type="{{ col.type === 'Number' ? 'number' : 'text' }}"
                  placeholder="{{ col.searchPlaceholder !== undefined ? col.searchPlaceholder : col.isDate === true ? ('bia.dateIso8601' | translate) : '' }}"
                  (input)="setSimpleFilter($event.target.value, col)"
                  [value]="dt.filters[col.field]?.value !== undefined ? dt.filters[col.field]?.value:''"
                  [ngClass]="{ 'p-state-filled': dt.filters[col.field]?.value !== '' }"
                />
              </ng-container>
            </div>
          </div>
        </span>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-columns="columns">
    <tr [pSelectableRow]="rowData">
      <td *ngIf="canSelectElement">
        <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
      </td>
      <td (click)="clickElement(rowData.id)" *ngFor="let col of columns">
        <bia-table-output
        [field]="col"
        [data]="getCellData(rowData, col)"
        >
          <ng-template pTemplate="specificOutput">
            <ng-container *ngTemplateOutlet="specificOutputTemplate;context: { field: col, data: getCellData(rowData, col) }" ></ng-container>
          </ng-template>
        </bia-table-output>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage" let-columns>
    <tr>
      <td class="app-empty-message" [attr.colspan]="columns?.length + 1">
        {{ 'bia.NoRecordsFound' | translate }}
      </td>
    </tr>
  </ng-template>
</p-table>
