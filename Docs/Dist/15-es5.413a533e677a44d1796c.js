function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(o){i=!0,a=o}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{DmGy:function(e,t,n){"use strict";n.r(t),n.d(t,"MemberModule",(function(){return Ye}));var r=n("tyNb"),i=n("kt0X"),a=n("snw9"),s=n("LRne"),c=n("wO+i"),o=n("eIep"),l=n("lJxs"),u=n("JIr8"),b=n("bOdf"),f=n("zp1y"),d=Object(i.h)("[Members] Load all by post",Object(i.m)()),m=Object(i.h)("[Members] Load",Object(i.m)()),h=Object(i.h)("[Members] Create",Object(i.m)()),p=Object(i.h)("[Members] Update",Object(i.m)()),y=Object(i.h)("[Members] Remove",Object(i.m)()),g=Object(i.h)("[Members] Multi Remove",Object(i.m)()),v=Object(i.h)("[Members] Save",Object(i.m)()),O=Object(i.h)("[Members] Load all by post success",Object(i.m)()),S=Object(i.h)("[Members] Load success",Object(i.m)()),j=Object(i.h)("[Members] Failure",Object(i.m)()),C=Object(i.h)("[Members] Open dialog edit"),k=Object(i.h)("[Members] Close dialog edit"),w=Object(i.h)("[Members] Open dialog new"),_=Object(i.h)("[Members] Close dialog new"),T=n("EVqC"),L=Object(T.a)({selectId:function(e){return e.id},sortComparer:!1}),M=L.getInitialState({totalCount:0,currentMember:{},lastLazyLoadEvent:{},loadingGet:!1,loadingGetAll:!1,displayEditDialog:!1,displayNewDialog:!1}),A=Object(i.j)(M,Object(i.l)(w,(function(e){return Object.assign(Object.assign({},e),{displayNewDialog:!0})})),Object(i.l)(_,(function(e){return Object.assign(Object.assign({},e),{displayNewDialog:!1})})),Object(i.l)(C,(function(e){return Object.assign(Object.assign({},e),{displayEditDialog:!0})})),Object(i.l)(k,(function(e){return Object.assign(Object.assign({},e),{displayEditDialog:!1})})),Object(i.l)(d,(function(e,t){return _objectDestructuringEmpty(t),Object.assign(Object.assign({},e),{loadingGetAll:!0})})),Object(i.l)(m,(function(e){return Object.assign(Object.assign({},e),{loadingGet:!0})})),Object(i.l)(O,(function(e,t){var n=t.result,r=t.event,i=L.setAll(n.data,e);return i.currentMember={},i.totalCount=n.totalCount,i.lastLazyLoadEvent=r,i.loadingGetAll=!1,i})),Object(i.l)(S,(function(e,t){var n=t.member;return Object.assign(Object.assign({},e),{currentMember:n,loadingGet:!1})})),Object(i.l)(j,(function(e,t){return _objectDestructuringEmpty(t),Object.assign(Object.assign({},e),{loadingGetAll:!1,loadingGet:!1})})));function x(e,t){return Object(i.f)({members:A})(e,t)}var I,D,E=Object(i.i)("members"),R=Object(i.k)(E,(function(e){return e.members})),$=Object(i.k)(R,(function(e){return e.totalCount})),N=Object(i.k)(R,(function(e){return e.currentMember})),B=Object(i.k)(R,(function(e){return e.lastLazyLoadEvent})),P=Object(i.k)(R,(function(e){return e.loadingGet})),z=Object(i.k)(R,(function(e){return e.loadingGetAll})),F=Object(i.k)(R,(function(e){return e.displayEditDialog})),G=Object(i.k)(R,(function(e){return e.displayNewDialog})),H=L.getSelectors(R).selectAll,U=n("dlt+"),J=n("fXoL"),V=((I=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e,"members")}return _createClass(n,[{key:"getAllBySite",value:function(e){return this.http.get("".concat(U.a.buildRoute("sites")).concat(e,"/members"))}}]),n}(U.a)).\u0275fac=function(e){return new(e||I)(J.Xb(J.r))},I.\u0275prov=J.Jb({token:I,factory:I.\u0275fac,providedIn:"root"}),I),X=n("Fx2S"),W=((D=function e(t,n,r,i){var C=this;_classCallCheck(this,e),this.actions$=t,this.memberDas=n,this.biaMessageService=r,this.store=i,this.loadAllByPost$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(d),Object(c.a)("event"),Object(o.a)((function(e){return C.memberDas.getListByPost(e).pipe(Object(l.a)((function(t){return O({result:t,event:e})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.load$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(m),Object(c.a)("id"),Object(o.a)((function(e){return C.memberDas.get(e).pipe(Object(l.a)((function(e){return S({member:e})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.create$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(h),Object(c.a)("member"),Object(b.a)((function(e){return Object(s.a)(e).pipe(Object(f.a)(C.store.select(B)))})),Object(o.a)((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C.memberDas.post(n).pipe(Object(l.a)((function(){return C.biaMessageService.showAddSuccess(),d({event:r})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.update$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(p),Object(c.a)("member"),Object(b.a)((function(e){return Object(s.a)(e).pipe(Object(f.a)(C.store.select(B)))})),Object(o.a)((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C.memberDas.put(n,n.id).pipe(Object(l.a)((function(){return C.biaMessageService.showUpdateSuccess(),d({event:r})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.destroy$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(y),Object(c.a)("id"),Object(b.a)((function(e){return Object(s.a)(e).pipe(Object(f.a)(C.store.select(B)))})),Object(o.a)((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C.memberDas.delete(n).pipe(Object(l.a)((function(){return C.biaMessageService.showDeleteSuccess(),d({event:r})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.multiDestroy$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(g),Object(c.a)("ids"),Object(b.a)((function(e){return Object(s.a)(e).pipe(Object(f.a)(C.store.select(B)))})),Object(o.a)((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C.memberDas.deletes(n).pipe(Object(l.a)((function(){return C.biaMessageService.showDeleteSuccess(),d({event:r})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))})),this.save$=Object(a.c)((function(){return C.actions$.pipe(Object(a.d)(v),Object(c.a)("members"),Object(b.a)((function(e){return Object(s.a)(e).pipe(Object(f.a)(C.store.select(B)))})),Object(o.a)((function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return C.memberDas.save(n).pipe(Object(l.a)((function(){return C.biaMessageService.showAddSuccess(),d({event:r})})),Object(u.a)((function(e){return C.biaMessageService.showError(),Object(s.a)(j({error:e}))})))})))}))}).\u0275fac=function(e){return new(e||D)(J.Xb(a.a),J.Xb(V),J.Xb(X.a),J.Xb(i.b))},D.\u0275prov=J.Jb({token:D,factory:D.\u0275fac}),D),q=n("quSY"),Q=n("itXk"),Y=n("Sa1B"),K=n("VfrA"),Z=n("QQar"),ee=n("s0Cq"),te=n("E6Oa"),ne=n("RdrV"),re=n("AYsD"),ie=n("Lnda"),ae=n("sYmb"),se=n("XiUz"),ce=n("ofXK"),oe=n("v8MJ"),le=n("/RsI"),ue=n("7zfz"),be=n("Ifmq"),fe=n("3Pt+"),de=n("+07z"),me=n("jIHw");function he(e,t){if(1&e&&(J.Hc(0),J.ec(1,"translateRoleLabel")),2&e){var n=t.$implicit,r=J.dc();J.Jc(" ",J.gc(1,1,null==n?null:n.value,r.translateService.currentLang)," ")}}function pe(e,t){if(1&e&&(J.Hc(0),J.ec(1,"translateRoleLabel")),2&e){var n=t.$implicit,r=J.dc();J.Jc(" ",J.gc(1,1,null==n?null:n.value,r.translateService.currentLang)," ")}}var ye,ge=function(){return{width:"100%"}},ve=((ye=function(){function e(t,n){_classCallCheck(this,e),this.formBuilder=t,this.translateService=n,this.member={},this.save=new J.n,this.cancel=new J.n,this.memberEditFormData={},this.initForm()}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){var t=this;if(this.allRoles&&this.member&&(e.member||e.allRoles)){var n={roles:this.member.roles?this.allRoles.filter((function(e){return t.member.roles.some((function(t){return t.roleId===e.id}))})):[]};this.form.patchValue(Object.assign({},n))}}},{key:"initForm",value:function(){this.form=this.formBuilder.group({roles:[this.memberEditFormData.roles]})}},{key:"onCancel",value:function(){this.form.reset(),this.cancel.next()}},{key:"onSubmit",value:function(){this.form.valid&&(this.updateMember(),this.form.reset())}},{key:"updateMember",value:function(){var e=Object.assign({},this.member),t=this.form.value.roles;e.roles.forEach((function(e){t.some((function(t){return t.id===e.roleId}))||(e.dtoState=be.a.Deleted)})),t.forEach((function(t){e.roles.some((function(e){return e.roleId===t.id}))||e.roles.push({id:0,memberId:e.id,roleId:t.id,dtoState:be.a.Added})})),this.save.emit(e)}}]),e}()).\u0275fac=function(e){return new(e||ye)(J.Nb(fe.b),J.Nb(ae.d))},ye.\u0275cmp=J.Hb({type:ye,selectors:[["app-member-edit-form"]],inputs:{member:"member",allRoles:"allRoles"},outputs:{save:"save",cancel:"cancel"},features:[J.zb],decls:14,vars:16,consts:[["fxLayout","column",3,"formGroup","submit"],["fxLayout","row","fxLayoutAlign","center",1,"app-field-container"],["fxFlex","90"],["formControlName","roles","multiple","multiple","checkbox","checkbox","optionLabel","labelEn",3,"options","showToggleAll"],["pTemplate","item"],["pTemplate","selectedItem"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","end end"],["pButton","","type","submit",3,"label","disabled"],["pButton","","type","button",1,"ui-button-secondary",3,"label","click"]],template:function(e,t){1&e&&(J.Tb(0,"form",0),J.bc("submit",(function(){return t.onSubmit()})),J.Tb(1,"div",1),J.Tb(2,"div",2),J.Tb(3,"label"),J.Hc(4),J.ec(5,"translate"),J.Sb(),J.Tb(6,"p-listbox",3),J.Fc(7,he,2,4,"ng-template",4),J.Fc(8,pe,2,4,"ng-template",5),J.Sb(),J.Sb(),J.Sb(),J.Tb(9,"div",6),J.Ob(10,"button",7),J.ec(11,"translate"),J.Tb(12,"button",8),J.bc("click",(function(){return t.onCancel()})),J.ec(13,"translate"),J.Sb(),J.Sb(),J.Sb()),2&e&&(J.kc("formGroup",t.form),J.Bb(4),J.Jc("",J.fc(5,9,"member.roles"),":"),J.Bb(2),J.Dc(J.nc(15,ge)),J.kc("options",t.allRoles)("showToggleAll",!1),J.Bb(4),J.lc("label",J.fc(11,11,"bia.save")),J.kc("disabled",!t.form.valid),J.Bb(2),J.lc("label",J.fc(13,13,"bia.cancel")))},directives:[fe.p,fe.k,se.d,fe.f,se.c,se.b,de.a,fe.j,fe.e,ue.e,se.e,me.b],pipes:[ae.c,re.a],styles:[".app-field-container[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px}"],changeDetection:0}),ye),Oe=n("y0gQ");function Se(e,t){if(1&e&&(J.Rb(0),J.Hc(1),J.ec(2,"async"),J.ec(3,"async"),J.Qb()),2&e){var n=J.dc(),r=null;J.Bb(1),J.Kc(" ",null==(r=J.fc(2,2,n.member$))?null:r.userFirstName," ",null==(r=J.fc(3,4,n.member$))?null:r.userLastName,"")}}function je(e,t){1&e&&J.Ob(0,"bia-spinner",4),2&e&&J.kc("overlay",!0)}var Ce,ke=function(){return{minWidth:"40vw"}},we=function(){return{overflow:"auto"}},_e=((Ce=function(){function e(t){_classCallCheck(this,e),this.store=t,this.display=!1,this.sub=new q.a,this.displayChange=new J.n}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.loading$=this.store.select(P).pipe(),this.allRoles$=this.store.pipe(Object(i.n)(Z.a)).pipe(),this.member$=this.store.select(N).pipe(),this.sub.add(this.store.select(F).pipe().subscribe((function(t){return e.display=t})))}},{key:"ngOnDestroy",value:function(){this.sub&&this.sub.unsubscribe()}},{key:"onSubmitted",value:function(e){this.store.dispatch(p({member:e})),this.close()}},{key:"onCancelled",value:function(){this.close()}},{key:"close",value:function(){this.store.dispatch(k())}}]),e}()).\u0275fac=function(e){return new(e||Ce)(J.Nb(i.b))},Ce.\u0275cmp=J.Hb({type:Ce,selectors:[["app-member-edit-dialog"]],outputs:{displayChange:"displayChange"},decls:11,vars:26,consts:[[3,"focusOnShow","visible","modal","closable","responsive","maximizable","contentStyle","visibleChange"],[4,"ngIf"],[3,"member","allRoles","cancel","save"],[3,"overlay",4,"ngIf"],[3,"overlay"]],template:function(e,t){1&e&&(J.Tb(0,"p-dialog",0),J.bc("visibleChange",(function(e){return t.display=e})),J.Tb(1,"p-header"),J.Hc(2),J.ec(3,"translate"),J.Fc(4,Se,4,6,"ng-container",1),J.ec(5,"async"),J.Sb(),J.Tb(6,"app-member-edit-form",2),J.bc("cancel",(function(){return t.onCancelled()}))("save",(function(e){return t.onSubmitted(e)})),J.ec(7,"async"),J.ec(8,"async"),J.Sb(),J.Fc(9,je,1,1,"bia-spinner",3),J.ec(10,"async"),J.Sb()),2&e&&(J.Dc(J.nc(24,ke)),J.kc("focusOnShow",!1)("visible",t.display)("modal",!0)("closable",!1)("responsive",!0)("maximizable",!0)("contentStyle",J.nc(25,we)),J.Bb(2),J.Jc(" ",J.fc(3,14,"member.manage")," "),J.Bb(2),J.kc("ngIf",!0!==J.fc(5,16,t.loading$)),J.Bb(2),J.kc("member",J.fc(7,18,t.member$))("allRoles",J.fc(8,20,t.allRoles$)),J.Bb(3),J.kc("ngIf",J.fc(10,22,t.loading$)))},directives:[le.a,ue.c,ce.m,ve,Oe.a],pipes:[ae.c,ce.b],styles:[""]}),Ce),Te=n("jIms"),Le=n("mCVk"),Me=n("FNYi"),Ae=n("V5BG");function xe(e,t){if(1&e&&(J.Hc(0),J.ec(1,"translateRoleLabel")),2&e){var n=t.$implicit,r=J.dc();J.Jc(" ",J.gc(1,1,null==n?null:n.value,r.translateService.currentLang)," ")}}function Ie(e,t){if(1&e&&(J.Hc(0),J.ec(1,"translateRoleLabel")),2&e){var n=t.$implicit,r=J.dc();J.Jc(" ",J.gc(1,1,null==n?null:n.value,r.translateService.currentLang)," ")}}var De,Ee,Re=function(){return{width:"100%"}},$e=((De=function(){function e(t,n,r){_classCallCheck(this,e),this.formBuilder=t,this.translateService=n,this.biaMessageService=r,this.searchUsers=new J.n,this.save=new J.n,this.cancel=new J.n,this.memberNewFormData={},this.initForm()}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){this.users&&e.users&&(this.users=this.users.sort((function(e,t){return e.firstName.localeCompare(t.firstName)})))}},{key:"initForm",value:function(){this.form=this.formBuilder.group({users:[this.memberNewFormData.users,fe.o.required],roles:[this.memberNewFormData.roles]})}},{key:"onCancel",value:function(){this.form.reset(),this.cancel.next()}},{key:"onSubmit",value:function(){this.form.valid&&(this.createMember(),this.form.reset())}},{key:"onSearchUsers",value:function(e){this.searchUsers.emit(e.query)}},{key:"onSelect",value:function(e){e&&e.siteIds&&e.siteIds.indexOf(this.site.id)>-1&&(this.selecteds.splice(this.selecteds.map((function(e){return e.id})).indexOf(e.id),1),this.biaMessageService.showInfo(this.translateService.instant("biaMsg.userAlreadyAssociatedSite")))}},{key:"createMember",value:function(){var e=this,t=new Array;this.form.value.users.forEach((function(n){var r={id:0,userId:n.id,userFirstName:n.firstName,userLastName:n.lastName,userLogin:n.login,siteId:e.site.id,roles:e.rolesToMemberRoles(e.form.value.roles),dtoState:be.a.Added};t.push(r)})),this.save.emit(t)}},{key:"rolesToMemberRoles",value:function(e){var t=new Array;return e&&e.length>0&&e.forEach((function(e){t.push({id:0,memberId:0,roleId:e.id,dtoState:be.a.Added})})),t}}]),e}()).\u0275fac=function(e){return new(e||De)(J.Nb(fe.b),J.Nb(ae.d),J.Nb(X.a))},De.\u0275cmp=J.Hb({type:De,selectors:[["app-member-new-form"]],inputs:{allRoles:"allRoles",site:"site",users:"users"},outputs:{searchUsers:"searchUsers",save:"save",cancel:"cancel"},features:[J.zb],decls:23,vars:29,consts:[["fxLayout","column",3,"formGroup","submit"],["fxLayout","row","fxLayoutAlign","center"],["fxFlex","90",1,"app-field-container"],[1,"md-inputfield"],["formControlName","users","placeholder","\xa0","field","displayName",3,"ngModel","multiple","suggestions","size","minLength","inputStyle","ngModelChange","completeMethod","onSelect"],[1,"bia-star-mandatory"],["fxLayout","row","fxLayoutAlign","center",1,"app-field-container"],["fxFlex","90"],["formControlName","roles","multiple","multiple","checkbox","checkbox","optionLabel","label",3,"options","showToggleAll"],["pTemplate","item"],["pTemplate","selectedItem"],["fxLayout","row","fxLayoutGap","5px","fxLayoutAlign","end end"],["pButton","","type","submit",3,"label","disabled"],["pButton","","type","button",1,"ui-button-secondary",3,"label","click"]],template:function(e,t){1&e&&(J.Tb(0,"form",0),J.bc("submit",(function(){return t.onSubmit()})),J.Tb(1,"div",1),J.Tb(2,"div",2),J.Tb(3,"span",3),J.Tb(4,"p-autoComplete",4),J.bc("ngModelChange",(function(e){return t.selecteds=e}))("completeMethod",(function(e){return t.onSearchUsers(e)}))("onSelect",(function(e){return t.onSelect(e)})),J.Sb(),J.Tb(5,"label"),J.Tb(6,"span",5),J.Hc(7,"*"),J.Sb(),J.Hc(8),J.ec(9,"translate"),J.Sb(),J.Sb(),J.Sb(),J.Sb(),J.Tb(10,"div",6),J.Tb(11,"div",7),J.Tb(12,"label"),J.Hc(13),J.ec(14,"translate"),J.Sb(),J.Tb(15,"p-listbox",8),J.Fc(16,xe,2,4,"ng-template",9),J.Fc(17,Ie,2,4,"ng-template",10),J.Sb(),J.Sb(),J.Sb(),J.Tb(18,"div",11),J.Ob(19,"button",12),J.ec(20,"translate"),J.Tb(21,"button",13),J.bc("click",(function(){return t.onCancel()})),J.ec(22,"translate"),J.Sb(),J.Sb(),J.Sb()),2&e&&(J.kc("formGroup",t.form),J.Bb(4),J.Dc(J.nc(26,Re)),J.kc("ngModel",t.selecteds)("multiple",!0)("suggestions",t.users)("size",30)("minLength",2)("inputStyle",J.nc(27,Re)),J.Bb(4),J.Ic(J.fc(9,18,"app.members")),J.Bb(5),J.Jc("",J.fc(14,20,"member.roles"),":"),J.Bb(2),J.Dc(J.nc(28,Re)),J.kc("options",t.allRoles)("showToggleAll",!1),J.Bb(4),J.lc("label",J.fc(20,22,"bia.save")),J.kc("disabled",!t.form.valid),J.Bb(2),J.lc("label",J.fc(22,24,"bia.cancel")))},directives:[fe.p,fe.k,se.d,fe.f,se.c,se.b,Ae.a,fe.j,fe.e,de.a,ue.e,se.e,me.b],pipes:[ae.c,re.a],styles:[".app-field-container[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px}"],changeDetection:0}),De),Ne=function(){return{minWidth:"40vw"}},Be=function(){return{overflow:"auto"}},Pe=((Ee=function(){function e(t){_classCallCheck(this,e),this.store=t,this.display=!1,this.sub=new q.a,this.displayChange=new J.n}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.allRoles$=this.store.select(Z.a).pipe(),this.users$=this.store.select(Le.a),this.sub.add(this.store.select(G).pipe().subscribe((function(t){return e.display=t})))}},{key:"ngOnDestroy",value:function(){this.sub&&this.sub.unsubscribe()}},{key:"onSubmitted",value:function(e){this.store.dispatch(v({members:e})),this.close()}},{key:"onCancelled",value:function(){this.close()}},{key:"close",value:function(){this.store.dispatch(_())}},{key:"onSearchUsers",value:function(e){this.store.dispatch(Object(Me.b)({filter:e}))}}]),e}()).\u0275fac=function(e){return new(e||Ee)(J.Nb(i.b))},Ee.\u0275cmp=J.Hb({type:Ee,selectors:[["app-member-new-dialog"]],inputs:{site:"site"},outputs:{displayChange:"displayChange"},decls:7,vars:21,consts:[[3,"focusOnShow","visible","modal","closable","responsive","maximizable","contentStyle","visibleChange"],[3,"site","users","allRoles","searchUsers","cancel","save"]],template:function(e,t){1&e&&(J.Tb(0,"p-dialog",0),J.bc("visibleChange",(function(e){return t.display=e})),J.Tb(1,"p-header"),J.Hc(2),J.ec(3,"translate"),J.Sb(),J.Tb(4,"app-member-new-form",1),J.bc("searchUsers",(function(e){return t.onSearchUsers(e)}))("cancel",(function(){return t.onCancelled()}))("save",(function(e){return t.onSubmitted(e)})),J.ec(5,"async"),J.ec(6,"async"),J.Sb(),J.Sb()),2&e&&(J.Dc(J.nc(19,Ne)),J.kc("focusOnShow",!1)("visible",t.display)("modal",!0)("closable",!1)("responsive",!0)("maximizable",!0)("contentStyle",J.nc(20,Be)),J.Bb(2),J.Jc(" ",J.fc(3,13,"member.add")," "),J.Bb(2),J.kc("site",t.site)("users",J.fc(5,15,t.users$))("allRoles",J.fc(6,17,t.allRoles$)))},directives:[le.a,ue.c,$e],pipes:[ae.c,ce.b],styles:[""]}),Ee);function ze(e,t){if(1&e){var n=J.Ub();J.Tb(0,"bia-table-header",6),J.bc("create",(function(){return J.yc(n),J.dc().onCreate()}))("delete",(function(){return J.yc(n),J.dc().onDelete()})),J.ec(1,"translate"),J.Sb()}if(2&e){var r=J.dc();J.kc("headerTitle",J.fc(1,4,"member.listOfSiteMembers")+(null==r.siteService.currentSite?null:r.siteService.currentSite.title))("canAdd",r.canAdd)("canBack",!0)("selectedElements",r.selectedMembers)}}function Fe(e,t){if(1&e&&J.Ob(0,"app-member-new-dialog",7),2&e){var n=J.dc();J.kc("site",n.siteService.currentSite)}}var Ge,He,Ue=((Ge=function(){function e(t,n,r,i,a){_classCallCheck(this,e),this.store=t,this.authService=n,this.translate=r,this.translateRoleLabelPipe=i,this.siteService=a,this.flex=!0,this.showColSearch=!1,this.globalSearchValue="",this.defaultPageSize=ee.b,this.pageSize=this.defaultPageSize,this.sub=new q.a,this.canEdit=!1,this.canDelete=!1,this.canAdd=!1,this.columns=[],this.displayedColumns=this.columns}return _createClass(e,[{key:"ngOnInit",value:function(){this.initTableConfiguration(),this.setPermissions(),this.initRoles(),this.initMembers(),this.initTotalCount(),this.initLoading()}},{key:"ngOnDestroy",value:function(){this.sub&&this.sub.unsubscribe()}},{key:"onCreate",value:function(){this.store.dispatch(w())}},{key:"onEdit",value:function(e){this.store.dispatch(m({id:e})),this.store.dispatch(C())}},{key:"onDelete",value:function(){this.selectedMembers&&this.store.dispatch(g({ids:this.selectedMembers.map((function(e){return e.id}))}))}},{key:"onSelectedElementsChanged",value:function(e){this.selectedMembers=e}},{key:"onPageSizeChange",value:function(e){this.pageSize=e}},{key:"onLoadLazy",value:function(e){if(this.siteService.currentSiteId>0){var t=Object.assign({siteId:+this.siteService.currentSiteId},e);this.store.dispatch(d({event:t}))}}},{key:"searchGlobalChanged",value:function(e){this.globalSearchValue=e}},{key:"displayedColumnsChanged",value:function(e){this.displayedColumns=e}},{key:"onToggleSearch",value:function(){this.showColSearch=!this.showColSearch}},{key:"toMemberListVM",value:function(e,t){var n=this;return{member:e,id:e.id,displayName:"".concat(e.userLastName," ").concat(e.userFirstName),roles:e.roles?this.roles.filter((function(t){return e.roles.some((function(e){return e.roleId===t.id}))})).map((function(e){return n.translateRoleLabelPipe.transform(e,t)})).join(", "):""}}},{key:"setPermissions",value:function(){this.canEdit=this.authService.hasPermission(ne.a.Member_Update),this.canDelete=this.authService.hasPermission(ne.a.Member_Delete),this.canAdd=this.authService.hasPermission(ne.a.Member_Save)}},{key:"initTableConfiguration",value:function(){this.tableConfiguration={columns:[Object.assign(new K.b("displayName","member.user"),{isSortable:!1,isSearchable:!1}),Object.assign(new K.b("roles","member.rolesForSite"),{isSortable:!1,isSearchable:!1})]},this.columns=this.tableConfiguration.columns.map((function(e){return{key:e.field,value:e.header}})),this.displayedColumns=_toConsumableArray(this.columns)}},{key:"initLoading",value:function(){this.loading$=this.store.select(z)}},{key:"initTotalCount",value:function(){this.totalCount$=this.store.select($)}},{key:"initMembers",value:function(){var e=this;this.members$=Object(Q.a)([this.store.select(H),Object(s.a)(this.translate.currentLang)]).pipe(Object(l.a)((function(t){return t[0].map((function(n){return e.toMemberListVM(n,t[1])}))})))}},{key:"initRoles",value:function(){var e=this;this.sub.add(this.store.select(Z.a).subscribe((function(t){return e.roles=t})))}}]),e}()).\u0275fac=function(e){return new(e||Ge)(J.Nb(i.b),J.Nb(te.a),J.Nb(ae.d),J.Nb(re.a),J.Nb(ie.a))},Ge.\u0275cmp=J.Hb({type:Ge,selectors:[["app-members-index"]],viewQuery:function(e,t){var n;1&e&&J.Lc(Y.a,!0),2&e&&J.wc(n=J.cc())&&(t.memberListComponent=n.first)},hostVars:2,hostBindings:function(e,t){2&e&&J.Fb("bia-flex",t.flex)},decls:13,vars:28,consts:[["fxLayout","","fxLayout.xs","column","fxLayoutWrap","wrap"],["fxFlex","100"],[3,"headerTitle","canAdd","canBack","selectedElements","create","delete",4,"ngIf"],[3,"defaultPageSize","length","columns","columnToDisplays","displayedColumnsChange","filter","pageSizeChange","toggleSearch"],[3,"elements","totalRecord","columnToDisplays","pageSize","configuration","showColSearch","globalSearchValue","canEdit","canSelectElement","loading","edit","loadLazy","selectedElementsChanged"],[3,"site",4,"ngIf"],[3,"headerTitle","canAdd","canBack","selectedElements","create","delete"],[3,"site"]],template:function(e,t){1&e&&(J.Tb(0,"div",0),J.Tb(1,"div",1),J.Fc(2,ze,2,6,"bia-table-header",2),J.ec(3,"async"),J.Tb(4,"bia-table-controller",3),J.bc("displayedColumnsChange",(function(e){return t.displayedColumnsChanged(e)}))("filter",(function(e){return t.searchGlobalChanged(e)}))("pageSizeChange",(function(e){return t.onPageSizeChange(e)}))("toggleSearch",(function(){return t.onToggleSearch()})),J.ec(5,"async"),J.Sb(),J.Tb(6,"bia-table",4),J.bc("edit",(function(e){return t.onEdit(e)}))("loadLazy",(function(e){return t.onLoadLazy(e)}))("selectedElementsChanged",(function(e){return t.onSelectedElementsChanged(e)})),J.ec(7,"async"),J.ec(8,"async"),J.ec(9,"async"),J.Sb(),J.Sb(),J.Sb(),J.Ob(10,"app-member-edit-dialog"),J.Fc(11,Fe,1,1,"app-member-new-dialog",5),J.ec(12,"async")),2&e&&(J.Bb(2),J.kc("ngIf",!1===J.fc(3,16,t.siteService.loading$)),J.Bb(2),J.kc("defaultPageSize",t.defaultPageSize)("length",J.fc(5,18,t.totalCount$))("columns",t.columns)("columnToDisplays",t.displayedColumns),J.Bb(2),J.kc("elements",J.fc(7,20,t.members$))("totalRecord",J.fc(8,22,t.totalCount$))("columnToDisplays",t.displayedColumns)("pageSize",t.pageSize)("configuration",t.tableConfiguration)("showColSearch",t.showColSearch)("globalSearchValue",t.globalSearchValue)("canEdit",t.canEdit)("canSelectElement",t.canDelete)("loading",J.fc(9,24,t.loading$)),J.Bb(5),J.kc("ngIf",!1===J.fc(12,26,t.siteService.loading$)))},directives:[se.d,se.b,ce.m,oe.a,Y.a,_e,Te.a,Pe],pipes:[ce.b,ae.c],styles:["[_nghost-%COMP%]{flex-direction:column}bia-table-controller[_ngcontent-%COMP%]{margin-left:-35px;margin-right:-35px}"]}),Ge),Je=n("PCNd"),Ve=n("CaOr"),Xe=n("oulN"),We=n("+dww"),qe=n("vuVG"),Qe=[{path:"",data:{breadcrumb:null,permission:ne.a.Member_List_Access},component:Ue,canActivate:[We.a]},{path:"**",redirectTo:""}],Ye=((He=function e(){_classCallCheck(this,e)}).\u0275mod=J.Lb({type:He}),He.\u0275inj=J.Kb({factory:function(e){return new(e||He)},imports:[[Je.a,Xe.a,Ve.a,qe.a,r.f.forChild(Qe),i.d.forFeature("members",x),a.b.forFeature([W])]]}),He)}}]);